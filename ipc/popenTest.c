/*-
 * Author: LBJ
 *
 * vi:set ts=4 sw=4:
 */
#ifndef lint
static const char rcsid[] = "$Id$";
#endif /* not lint */

/**
 * @file	popenTest.c
 * @brief	
 */

#include <stdio.h>
#include <sys/wait.h>
#include "ourheader.h"

#define PAGER "${PAGER:-more}" //shell命令${PAGER:-more}的意思是如果shell变量PAGER已经定义且其值非空，则使用其值，否则使用字符串more

int
main(int argc, char *argv[])
{
	char line[MAXLINE];
	FILE *fpin, *fpout;
	if (argc != 2)
		err_quit("usage: a.out <pathname>");
	//打开要输入的文件
	if ((fpin = fopen(argv[1], "r")) == NULL)
		err_quit("cant't open");
	//通过管道传递给shell运行的PAGER程序
	if ((fpout = popen(PAGER, "w")) == NULL)
		err_quit("popen error");
	//从输入的文件一行一行读入
	while (fgets(line, MAXLINE, fpin) != NULL)
	{
		//不断输出到PAGER程序中
		if (fputs(line, fpout) == EOF)
			err_quit("fputs error to pipe");
	}
	if (ferror(fpin))
		err_quit("fgets error");
	if (pclose(fpout) == -1)
		err_quit("pclose error");
	exit(0);
}	


